{% extends "base.html" %}

{% block title %}Profil - Solara{% endblock %}

{% block content %}
    <div class="content">
        <div class="topbar">
            <!-- <div class="topbar-logo">Solara</div> --> <!-- Logo can be shown here on mobile if needed -->
            <div class="topbar-search">
                <input type="text" placeholder="Ara">
            </div>
        </div>
        <div class="main-content">
            <div class="post-list">
                <div class="profile-header">
                    <img src="{{ user.profile_picture_url if user.profile_picture_url else url_for('static', filename='images/default-avatar.png') }}" alt="Profile Avatar" class="profile-avatar-large">
                    <div class="profile-info">
                        <div class="profile-name">{{ user.full_name if user.full_name else user.username }}</div>
                        <div class="profile-username">@{{ user.username }}</div>
                        <div class="profile-stats">
                            <div class="profile-stats-item">
                                <span class="profile-stats-number">{{ user.post_count if user.post_count is not none else 0 }}</span> <span class="profile-stats-label">Gönderi</span>
                            </div>
                            <div class="profile-stats-item">
                                <span class="profile-stats-number">{{ user.followers_count if user.followers_count is not none else 0 }}</span> <span class="profile-stats-label">Takipçi</span>
                            </div>
                            <div class="profile-stats-item">
                                <span class="profile-stats-number">{{ user.following_count if user.following_count is not none else 0 }}</span> <span class="profile-stats-label">Takip</span>
                            </div>
                            <div class="profile-stats-item">
                                <span class="profile-stats-number">0</span> <span class="profile-stats-label">Solara Puanı</span>
                            </div>
                        </div>
                        <div class="profile-bio">
                            {{ user.bio if user.bio is not none else 'Henüz biyografi eklenmedi.' }}
                        </div>
                        <div class="profile-buttons-container">
                            {# Edit button visibility is handled by profile.js based on logged-in user vs profile user #}
                            <button class="profile-edit-button" style="display: none;">Profili Düzenle</button>
                            {# Follow button state (class and text) is set here by server and updated by profile.js #}
                            {# Visibility (for own profile vs others) is handled by profile.js #}
                            <button class="profile-follow-button {% if is_following %}following{% endif %}" data-user-id="{{ user.user_id }}">
                                {% if is_following %}Takip Ediliyor{% else %}Takip Et{% endif %}
                            </button>
                        </div>
                    </div>
                </div>

                {# Loop through actual posts passed from the backend #}
                {% if posts %}
                    {% for post in posts %}
                    <div class="post" data-post-id="{{ post.post_id }}"> {# Add data-post-id #}
                        <div class="post-header">
                            {# Use post's author data #}
                            <img src="{{ post.profile_picture_url if post.profile_picture_url else url_for('static', filename='images/default-avatar.png') }}" alt="Avatar" class="post-avatar">
                            <div class="post-author-info">
                                {# Link to the post author's profile using the correct endpoint name #}
                                <a href="{{ url_for('view_profile_page', username=post.username) }}" class="post-author">{{ post.username }}</a>
                                {# Format timestamp - consider using a Jinja filter or moment.js via base.html for better formatting #}
                                <div class="post-time">{{ post.created_at.strftime('%b %d') if post.created_at else 'Unknown time' }}</div>
                            </div>
                        </div>
                        <div class="post-content">
                            <p>{{ post.content_text | safe if post.content_text else '' }}</p> {# Use safe filter if content might contain HTML #}
                            {% if post.image_url %}
                                <img src="{{ post.image_url }}" alt="Post Image" class="post-image">
                            {% endif %}
                        </div>
                        {# Add post actions - profile.js will handle clicks #}
                        <div class="post-actions">
                            <div class="post-actions-item">
                                {# Set initial state based on 'is_liked' passed from backend #}
                                <i class="{% if post.is_liked %}fas liked{% else %}far{% endif %} fa-heart" {% if post.is_liked %}style="color: red;"{% endif %}></i>
                                <span>{{ post.like_count if post.like_count is not none else 0 }}</span>
                            </div>
                            <div class="post-actions-item">
                                <i class="far fa-comment"></i>
                                <span>{{ post.comment_count if post.comment_count is not none else 0 }}</span>
                            </div>
                            <div class="post-actions-item post-actions-item-right">
                                {# Set initial state based on 'is_saved' passed from backend #}
                                <i class="{% if post.is_saved %}fas saved{% else %}far{% endif %} fa-bookmark" {% if post.is_saved %}style="color: blue;"{% endif %}></i>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; padding: 20px;">Bu kullanıcının henüz gönderisi yok.</p> {# No posts yet message #}
                {% endif %}
            </div>
            <div class="sidebar-right">
                <div class="sidebar-right-section">
                    <div class="sidebar-right-title">Önerilenler</div>
                </div>
                <div class="sidebar-right-section">
                    <div class="sidebar-right-title">Haftanın sıralaması</div>
                    <div class="weekly-rank-item">
                        <div class="weekly-rank-number">1</div>
                        <div class="weekly-rank-username">baranelmas</div>
                        <div class="weekly-rank-score">1841</div>
                    </div>
                    <div class="weekly-rank-item">
                        <div class="weekly-rank-number">2</div>
                        <div class="weekly-rank-username">mrtszn00</div>
                        <div class="weekly-rank-score">1614</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts_extra %}
    {# Inline scripts removed as functionality is now in profile.js #}
    <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endblock %}
